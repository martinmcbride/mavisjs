var mavis=mavis||{};mavis.BLUE="#2340c9";mavis.RED="#c92323";mavis.GREEN="#23c926";mavis.PURPLE="#8a23c9";mavis.CYAN="#23a0c9";mavis.ORANGE="#c97e23";mavis.YELLOW="#e5e110";mavis.GRAY="#767676";mavis.BLUE50="#909FE4";mavis.RED50="#E49090";mavis.GREEN50="#90E492";mavis.PURPLE50="#C490E4";mavis.CYAN50="#90CFE4";mavis.ORANGE50="#E4BE90";mavis.YELLOW50="#F2F087";mavis.GRAY50="#BABABA";mavis.SANS="40pt Verdana, Geneva, sans-serif";mavis.SERIF="40pt Georgia, serif";mavis.SERIFI="Italic 40pt Georgia, serif";
mavis.countDecimals=function(a){return Math.floor(a.valueOf())===a.valueOf()?0:a.toString().split(".")[1].length||0};mavis.Point=function(a,b){this.x=a;this.y=b};mavis.p_copy=function(a){return new mavis.Point(a.x,a.y)};mavis.p_add=function(a,b){return new mavis.Point(a.x+b.x,a.y+b.y)};mavis.p_sub=function(a,b){return new mavis.Point(a.x-b.x,a.y-b.y)};mavis.p_mul=function(a,b){return new mavis.Point(a.x*b,a.y*b)};mavis.p_interp=function(a,b,c){return new mavis.Point((1-c)*a.x+c*b.x,(1-c)*a.y+c*b.y)};
mavis.line_length=function(a,b){return Math.sqrt((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y))};mavis.line_unit=function(a,b){var c=Math.sqrt((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y));return new mavis.Point((b.x-a.x)/c,(b.y-a.y)/c)};mavis.line_perp=function(a,b){var c=Math.sqrt((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y));return new mavis.Point(-(b.y-a.y)/c,(b.x-a.x)/c)};mavis.line_angle=function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)};
mavis.angle_norm=function(a){for(;0>a;)a+=2*Math.PI;for(;a>2*Math.PI;)a-=2*Math.PI;return a};mavis.angle_nonreflex=function(a){a=mavis.angle_norm(a);a>Math.PI&&(a=2*Math.PI-a);return a};mavis.angle_points=function(a,b,c,d){d=void 0===d?!1:d;a=mavis.line_angle(a,b);b=mavis.line_angle(c,b);b=mavis.angle_norm(a-b);d&&(b=mavis.angle_nonreflex(b));return b};
mavis.Axis=function(a){a=void 0===a?{}:a;this.start=0;this.range=1;this.pstart=0;this.prange=100;this.div=1;for(var b in a)this[b]=a[b];this.divs=[];this.setDivs()};mavis.Axis.prototype.setDivs=function(){this.divs=[];for(n=Math.ceil(this.start/this.div)*this.div;n<=this.start+this.range;)this.divs.push(n),n+=this.div};mavis.Axis.prototype.toPixel=function(a){return(a-this.start)*this.prange/this.range+this.pstart};
mavis.Axis.prototype.toVal=function(a){return(a-this.pstart)*this.range/this.prange+this.start};mavis.Axes=function(a,b,c){this.xAxis=a;this.yAxis=b;this.font="20px Arial";this.strokeStyle="black";this.fillStyle="white";this.lineWidth=3;this.lineDash=[];this.divStrokeStyle="#a0a0ff";this.divLineWidth=2;this.fillAlpha=this.strokeAlpha=1;for(var d in c)this[d]=c[d]};mavis.Axes.prototype.toPixel=function(a){return new mavis.Point(this.xAxis.toPixel(a.x),this.yAxis.prange-this.yAxis.toPixel(a.y))};
mavis.Axes.prototype.toVal=function(a){return new mavis.Point(this.xAxis.toVal(a.x),this.yAxis.toVal(this.yAxis.prange-a.y))};mavis.Axes.prototype.toPixelLength=function(a){return this.xAxis.toPixel(a)-this.xAxis.toPixel(0)};
mavis.Axes.prototype.draw=function(a){this.xAxis.setDivs();this.yAxis.setDivs();this.fillStyle&&(a.beginPath(),a.fillStyle=this.fillStyle,a.rect(this.xAxis.pstart,this.yAxis.pstart,this.xAxis.prange,this.yAxis.prange),a.fill());a.save();this.applyClip(a);a.globalAlpha=this.strokeAlpha;if(this.divStrokeStyle){a.beginPath();a.lineWidth=this.divLineWidth;a.setLineDash(this.lineDash);a.strokeStyle=this.divStrokeStyle;for(var b=0;b<this.xAxis.divs.length;b++)n=this.toPixel(new mavis.Point(this.xAxis.divs[b],
0)).x,a.moveTo(n,this.yAxis.pstart),a.lineTo(n,this.yAxis.pstart+this.yAxis.prange);for(b=0;b<this.yAxis.divs.length;b++)n=this.toPixel(new mavis.Point(0,this.yAxis.divs[b])).y,a.moveTo(this.xAxis.pstart,n),a.lineTo(this.xAxis.pstart+this.xAxis.prange,n);a.stroke()}a.beginPath();a.lineWidth=this.lineWidth;a.strokeStyle=this.strokeStyle;var c=this.toPixel(new mavis.Point(0,0));c.x>=this.xAxis.pstart&&c.x<this.xAxis.pstart+this.xAxis.prange&&(a.moveTo(c.x,this.yAxis.pstart),a.lineTo(c.x,this.yAxis.pstart+
this.yAxis.prange));c.y>=this.yAxis.pstart&&c.y<this.yAxis.pstart+this.yAxis.prange&&(a.moveTo(this.xAxis.pstart,c.y),a.lineTo(this.xAxis.pstart+this.xAxis.prange,c.y));a.stroke();a.beginPath();a.lineWidth=this.lineWidth;a.strokeStyle=this.strokeStyle;a.fillStyle=this.strokeStyle;a.font=this.font;a.textAlign="right";a.textBaseline="top";for(var d=mavis.countDecimals(this.xAxis.div),b=0;b<this.xAxis.divs.length;b++)if(this.xAxis.divs[b]){var e=this.toPixel(new mavis.Point(this.xAxis.divs[b],0));e.x+
10<this.xAxis.pstart+this.xAxis.prange&&e.x-10>this.xAxis.pstart&&(a.fillText(this.xAxis.divs[b].toFixed(d),e.x,e.y+3),a.moveTo(e.x,e.y),a.lineTo(e.x,e.y+5))}a.textAlign="right";a.textBaseline="bottom";d=mavis.countDecimals(this.yAxis.div);for(b=0;b<this.yAxis.divs.length;b++)this.yAxis.divs[b]&&(e=this.toPixel(new mavis.Point(0,this.yAxis.divs[b])),e.y+10<this.yAxis.pstart+this.yAxis.prange&&e.y-10>this.yAxis.pstart&&(a.fillText(this.yAxis.divs[b].toFixed(d),e.x-8,e.y),a.moveTo(e.x,e.y),a.lineTo(e.x-
5,e.y)));a.moveTo(c.x+8,c.y);a.arc(c.x,c.y,8,0,2*Math.PI,!1);a.stroke();a.restore()};mavis.Axes.prototype.applyClip=function(a){a.beginPath();a.rect(this.xAxis.pstart,this.yAxis.pstart,this.xAxis.prange,this.yAxis.prange);a.clip()};mavis.XYPlot=function(a,b,c){this.axes=a;this.fn=b;this.strokeStyle="black";this.lineWidth=4;this.strokeAlpha=1;for(var d in c)this[d]=c[d]};mavis.XYPlot.prototype.recalc=function(a){};
mavis.XYPlot.prototype.singularity=function(a,b){var c=this.axes.yAxis.start,d=this.axes.yAxis.start+this.axes.yAxis.range;return a<c&&b>d?!0:b<c&&a>d?!0:!1};
mavis.XYPlot.prototype.draw=function(a){var b;a.save();this.axes.applyClip(a);a.globalAlpha=this.strokeAlpha;a.beginPath();a.lineWidth=this.lineWidth;a.strokeStyle=this.strokeStyle;for(var c=this.axes.xAxis.pstart;c<this.axes.xAxis.pstart+this.axes.xAxis.prange;c++){var d=this.axes.toVal(new mavis.Point(c,0)).x,d=this.fn(d),e=this.axes.toPixel(new mavis.Point(0,d)).y;c==this.axes.xAxis.spstart?a.moveTo(c,e):this.singularity(d,b)?0>e?a.moveTo(c,-1):a.moveTo(c,1E5):a.lineTo(c,e);b=d}a.stroke();a.restore()};
mavis.DrawCross=function(a,b,c,d,e,f,g){a.beginPath();a.moveTo(b-d,c-d);a.lineTo(b+d,c+d);a.moveTo(b+d,c-d);a.lineTo(b-d,c+d);e&&(a.strokeStyle=e,a.lineWidth=f,a.stroke())};mavis.DrawCircle=function(a,b,c,d,e,f,g){a.beginPath();a.arc(b,c,d,0,2*Math.PI,!1);g&&(a.fillStyle=g,a.fill());e&&(a.strokeStyle=e,a.lineWidth=f,a.stroke())};
mavis.PointMarker=function(a,b){this.axes=a;this.y=this.x=0;this.pointStyle=mavis.DrawCross;this.size=10;this.strokeStyle="black";this.lineWidth=4;this.fillStyle="white";this.fillAlpha=this.strokeAlpha=1;for(var c in b)this[c]=b[c]};mavis.PointMarker.prototype.draw=function(a){a.save();var b=this.axes.toPixel(new mavis.Point(this.x,this.y));this.pointStyle(a,b.x,b.y,this.size,this.strokeStyle,this.lineWidth,this.fillStyle);a.restore()};
mavis.Line=function(a,b){this.axes=a;mavis.Line.SEGMENT=0;mavis.Line.RAY=1;mavis.Line.LINE=2;this.start=new mavis.Point(0,0);this.end=new mavis.Point(1,1);this.angle=0;this.length=1;this.type=mavis.Line.LINE;this.strokeStyle="black";this.lineWidth=4;this.lineDash=[];this.strokeAlpha=1;for(var c in b)this[c]=b[c]};
mavis.Line.prototype.draw=function(a){a.save();this.axes.applyClip(a);a.globalAlpha=this.strokeAlpha;a.beginPath();a.lineWidth=this.lineWidth;a.setLineDash(this.lineDash);a.strokeStyle=this.strokeStyle;var b=this.axes.toPixel(this.start),c=this.axes.toPixel(this.end);a.moveTo(b.x,b.y);a.lineTo(c.x,c.y);a.stroke();a.restore()};mavis.Line.prototype.getUnit=function(){return mavis.line_unit(this.start,this.end)};mavis.Line.prototype.getUnitPerp=function(){return mavis.line_perp(this.start,this.end)};
mavis.Tick=function(a,b){this.axes=a;this.start=new mavis.Point(0,0);this.end=new mavis.Point(1,1);this.count=1;this.strokeStyle="black";this.lineWidth=4;this.strokeAlpha=1;for(var c in b)this[c]=b[c]};
mavis.Tick.prototype.draw=function(a){a.save();this.axes.applyClip(a);a.globalAlpha=this.strokeAlpha;a.lineWidth=this.lineWidth;a.strokeStyle=this.strokeStyle;var b=this.axes.toPixel(this.start),c=this.axes.toPixel(this.end),d=new mavis.Point((b.x+c.x)/2,(b.y+c.y)/2),e=Math.sqrt((b.x-c.x)*(b.x-c.x)+(b.y-c.y)*(b.y-c.y)),b=new mavis.Point((b.x-c.x)/e,(b.y-c.y)/e),c=new mavis.Point(b.y,-b.x);1==this.count?this.drawTick(a,d,c):2==this.count?(this.drawTick(a,new mavis.Point(d.x-b.x*this.lineWidth,d.y-
b.y*this.lineWidth),c),this.drawTick(a,new mavis.Point(d.x+b.x*this.lineWidth,d.y+b.y*this.lineWidth),c)):(this.drawTick(a,new mavis.Point(d.x-b.x*this.lineWidth*2,d.y-b.y*this.lineWidth*2),c),this.drawTick(a,d,c),this.drawTick(a,new mavis.Point(d.x+b.x*this.lineWidth*2,d.y+b.y*this.lineWidth*2),c));a.restore()};mavis.Tick.prototype.drawTick=function(a,b,c){a.beginPath();a.moveTo(b.x+c.x*this.lineWidth*3,b.y+c.y*this.lineWidth*3);a.lineTo(b.x-c.x*this.lineWidth*3,b.y-c.y*this.lineWidth*3);a.stroke()};
mavis.Arrow=function(a,b){this.axes=a;this.start=new mavis.Point(0,0);this.end=new mavis.Point(1,1);this.count=1;this.strokeStyle="black";this.lineWidth=4;this.strokeAlpha=1;for(var c in b)this[c]=b[c]};
mavis.Arrow.prototype.draw=function(a){a.save();this.axes.applyClip(a);a.globalAlpha=this.strokeAlpha;a.lineWidth=this.lineWidth;a.strokeStyle=this.strokeStyle;var b=this.axes.toPixel(this.start),c=this.axes.toPixel(this.end),d=new mavis.Point((b.x+c.x)/2,(b.y+c.y)/2),e=Math.sqrt((b.x-c.x)*(b.x-c.x)+(b.y-c.y)*(b.y-c.y)),b=new mavis.Point((b.x-c.x)/e,(b.y-c.y)/e),c=new mavis.Point(b.y,-b.x);1==this.count?this.drawArrow(a,d,b,c):2==this.count?(this.drawArrow(a,new mavis.Point(d.x-b.x*this.lineWidth*
1.5,d.y-b.y*this.lineWidth*1.5),b,c),this.drawArrow(a,new mavis.Point(d.x+b.x*this.lineWidth*1.5,d.y+b.y*this.lineWidth*1.5),b,c)):(this.drawArrow(a,new mavis.Point(d.x-b.x*this.lineWidth*3,d.y-b.y*this.lineWidth*3),b,c),this.drawArrow(a,d,b,c),this.drawArrow(a,new mavis.Point(d.x+b.x*this.lineWidth*3,d.y+b.y*this.lineWidth*3),b,c));a.restore()};
mavis.Arrow.prototype.drawArrow=function(a,b,c,d){a.beginPath();a.moveTo(b.x+(3*c.x+3*d.x)*this.lineWidth,b.y+(3*c.y+3*d.y)*this.lineWidth);a.lineTo(b.x,b.y);a.lineTo(b.x+(3*c.x-3*d.x)*this.lineWidth,b.y+(3*c.y-3*d.y)*this.lineWidth);a.stroke()};mavis.Measure=function(a,b){this.axes=a;this.start=new mavis.Point(0,0);this.end=new mavis.Point(1,1);this.strokeStyle="black";this.lineWidth=4;this.strokeAlpha=1;for(var c in b)this[c]=b[c]};
mavis.Measure.prototype.draw=function(a){a.save();this.axes.applyClip(a);a.globalAlpha=this.strokeAlpha;a.lineWidth=this.lineWidth;a.strokeStyle=this.strokeStyle;var b=this.axes.toPixel(this.start),c=this.axes.toPixel(this.end),d=Math.sqrt((b.x-c.x)*(b.x-c.x)+(b.y-c.y)*(b.y-c.y)),d=new mavis.Point((b.x-c.x)/d,(b.y-c.y)/d),e=new mavis.Point(d.y,-d.x);this.drawMeasure(a,b,d,e);this.drawMeasure(a,c,d,e);a.restore()};
mavis.Measure.prototype.drawMeasure=function(a,b,c,d){a.beginPath();a.moveTo(b.x+7*d.x*this.lineWidth,b.y+7*d.y*this.lineWidth);a.lineTo(b.x+1*d.x*this.lineWidth,b.y+1*d.y*this.lineWidth);a.stroke()};mavis.Angle=function(a,b){this.axes=a;this.a=new mavis.Point(1,0);this.b=new mavis.Point(0,0);this.c=new mavis.Point(0,1);this.radius=20;this.noReflex=this.rightAngle=!1;this.count=1;this.strokeStyle="black";this.lineWidth=4;this.strokeAlpha=1;for(var c in b)this[c]=b[c]};
mavis.Angle.prototype.draw=function(a){a.save();this.axes.applyClip(a);a.globalAlpha=this.strokeAlpha;a.lineWidth=this.lineWidth;a.strokeStyle=this.strokeStyle;var b=this.axes.toPixel(this.a),c=this.axes.toPixel(this.b),d=this.axes.toPixel(this.c),b=Math.atan2(b.y-c.y,b.x-c.x),d=Math.atan2(d.y-c.y,d.x-c.x);if((0>b-d&&b-d>-Math.PI||b-d>Math.PI)&&this.noReflex)var e=b,b=d,d=e;1==this.count?this.drawAngle(a,c,b,d,this.radius):2==this.count?(this.drawAngle(a,c,b,d,this.radius-this.lineWidth),this.drawAngle(a,
c,b,d,this.radius+this.lineWidth)):(this.drawAngle(a,c,b,d,this.radius-2*this.lineWidth),this.drawAngle(a,c,b,d,this.radius),this.drawAngle(a,c,b,d,this.radius+2*this.lineWidth));a.restore()};mavis.Angle.prototype.drawAngle=function(a,b,c,d,e){a.beginPath();this.rightAngle?(v=new mavis.Point(Math.cos(c),Math.sin(c)),pv=new mavis.Point(Math.cos(d),Math.sin(d)),a.moveTo(b.x+v.x*e,b.y+v.y*e),a.lineTo(b.x+(v.x+pv.x)*e,b.y+(v.y+pv.y)*e),a.lineTo(b.x+pv.x*e,b.y+pv.y*e)):a.arc(b.x,b.y,e,c,d,!0);a.stroke()};
mavis.Circle=function(a,b){this.axes=a;this.centre=new mavis.Point(0,0);this.radius=1;this.startAngle=0;this.endAngle=2*Math.PI;this.direction=!1;this.strokeStyle="black";this.lineWidth=4;this.lineDash=[];this.fillStyle="white";this.fillAlpha=this.strokeAlpha=1;for(var c in b)this[c]=b[c]};
mavis.Circle.prototype.draw=function(a){a.save();this.axes.applyClip(a);var b=this.axes.toPixel(this.centre),c=this.axes.toPixelLength(this.radius);this.fillStyle&&(a.globalAlpha=this.fillAlpha,a.beginPath(),a.fillStyle=this.fillStyle,a.arc(b.x,b.y,c,-this.startAngle,-this.endAngle,!this.direction),a.fill());this.strokeStyle&&(a.globalAlpha=this.strokeAlpha,a.beginPath(),a.lineWidth=this.lineWidth,a.strokeStyle=this.strokeStyle,a.setLineDash(this.lineDash),a.arc(b.x,b.y,c,-this.startAngle,-this.endAngle,
!this.direction),a.stroke());a.restore()};mavis.Polygon=function(a,b){this.axes=a;this.strokeStyle="black";this.lineWidth=4;this.fillStyle="white";this.fillAlpha=this.strokeAlpha=1;this.lineJoin="bevel";this.closed=!0;for(var c in b)this[c]=b[c];this.points=[]};
mavis.Polygon.prototype.createRegular=function(a,b,c,d,e){b=void 0===b?1:b;c=void 0===c?0:c;d=void 0===d?0:d;var f=2*Math.PI/a;e=-Math.PI/2+f/2+(void 0===e?0:e);this.points=[];for(var g=0;g<a;g++)this.points.push(new mavis.Point(c+b*Math.cos(e),d+b*Math.sin(e))),e+=f};mavis.Polygon.prototype.offsetPoints=function(a,b){this.points=[];for(p in b)p=mavis.p_add(b[p],a),this.points.push(p)};
mavis.Polygon.prototype.draw=function(a){if(!(2>this.points.length)){a.save();this.axes.applyClip(a);a.beginPath();for(var b,c=0;c<this.points.length;c++)b=this.axes.toPixel(this.points[c]),c?a.lineTo(b.x,b.y):a.moveTo(b.x,b.y);this.closed&&a.closePath();this.fillStyle&&(a.globalAlpha=this.fillAlpha,a.fillStyle=this.fillStyle,a.fill());this.strokeStyle&&(a.globalAlpha=this.strokeAlpha,a.lineWidth=this.lineWidth,a.lineJoin=this.lineJoin,a.strokeStyle=this.strokeStyle,a.stroke());a.restore()}};
mavis.Text=function(a,b){this.axes=a;this.position=new mavis.Point(0,0);this.align="center";this.valign="middle";this.font="40pt Verdana, Geneva, sans-serif";this.content="text";this.offset=null;this.fillStyle="black";this.fillAlpha=1;for(var c in b)this[c]=b[c]};
mavis.Text.prototype.draw=function(a){a.save();this.axes.applyClip(a);a.globalAlpha=this.fillAlpha;var b=this.axes.toPixel(this.position);a.font=this.font;a.textAlign=this.align;a.textBaseline=this.valign;this.offset&&(b=this.offset.offset(b));this.fillStyle&&(a.fillStyle=this.fillStyle,a.fillText(this.content,b.x,b.y));a.restore()};mavis.TextOffsetAngle=function(a,b,c,d){this.axes=a;this.p1=b;this.p2=c;this.dist=d};
mavis.TextOffsetAngle.prototype.offset=function(a){var b=this.axes.toPixel(this.p1),c=this.axes.toPixel(this.p2),b=Math.atan2(b.y-a.y,b.x-a.x),b=(b+Math.atan2(c.y-a.y,c.x-a.x))/2;return new mavis.Point(a.x+this.dist*Math.cos(b),a.y+this.dist*Math.sin(b))};
mavis.ControlPoint=function(a,b,c){this.stage=b;this.axes=a;this.position=new mavis.Point(0,0);this.radius=10;this.fillStyle="red";this.onMove=this.constraint=null;for(var d in c)this[d]=c[d];this.shape=new createjs.Shape;this.shape.graphics.beginFill(this.fillStyle).drawCircle(0,0,this.radius);this.stage.addChild(this.shape);a=axes.toPixel(this.position);this.shape.x=a.x;this.shape.y=a.y;this.shape.on("pressmove",this.onPressMove);this.shape.owner=this};
mavis.ControlPoint.prototype.onPressMove=function(a){var b=a.target.owner;b.position=b.axes.toVal(new mavis.Point(a.stageX,a.stageY));b.constraint&&(b.position=b.constraint.constrain(b.position));var c=b.axes.toPixel(b.position);a.target.x=c.x;a.target.y=c.y;if(b.onMove)b.onMove(a)};mavis.ConstrainInteger=function(){};mavis.ConstrainInteger.prototype.constrain=function(a){return new mavis.Point(Math.round(a.x),Math.round(a.y))};
mavis.ConstrainRectangle=function(a,b,c,d){this.minX=a;this.maxX=c;this.minY=b;this.maxY=d};mavis.ConstrainRectangle.prototype.constrain=function(a){var b=a.x;a=a.y;b<this.minX?b=this.minX:b>this.maxX&&(b=this.maxX);a<this.minY?a=this.minY:a>this.maxY&&(a=this.maxY);return new mavis.Point(b,a)};mavis.ConstrainCircle=function(a){this.circle=circle};
mavis.ConstrainCircle.prototype.constrain=function(a){var b=a.x;a=a.y;a=Math.atan2(a-circle.centre.y,b-circle.centre.x);b=circle.centre.x+circle.radius*Math.cos(a);a=circle.centre.y+circle.radius*Math.sin(a);return new mavis.Point(b,a)};
